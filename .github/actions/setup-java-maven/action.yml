name: 'Setup Java with Maven Cache'
description: 'Sets up JDK 11 with comprehensive Maven caching for faster builds'

inputs:
  java-version:
    description: 'Java version to setup'
    required: false
    default: '17'
  java-distribution:
    description: 'Java distribution'
    required: false
    default: 'temurin'

runs:
  using: 'composite'
  steps:
    - name: Set up JDK
      uses: actions/setup-java@v4
      with:
        java-version: ${{ inputs.java-version }}
        distribution: ${{ inputs.java-distribution }}
        cache: 'maven'
    
    # Additional Maven local repository caching for faster dependency resolution
    - name: Cache Maven dependencies
      uses: actions/cache@v4
      with:
        path: |
          ~/.m2/repository
          ~/.m2/wrapper
        key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
        restore-keys: |
          ${{ runner.os }}-maven-
    
    # Cache Maven build output for incremental builds
    - name: Cache Maven build
      uses: actions/cache@v4
      with:
        path: |
          target
          **/target
        key: ${{ runner.os }}-maven-build-${{ github.sha }}
        restore-keys: |
          ${{ runner.os }}-maven-build-
    
    - name: Display cache info
      shell: bash
      run: |
        echo "âœ… Java and Maven cache configured"
        echo "ðŸ“¦ Maven version: $(mvn -version | head -n 1)"
        echo "ðŸ”„ Cache is shared across all workflow jobs"
        echo "ðŸ’¡ Dependencies downloaded in one job are reused in others"

